<div class="row content-border-margin-regular">
    <div class="col-sm-5">
        <div>
            <form name="laborderForm" class="form-horizontal" autocomplete="off">
                <poc-authorize privilege="'Write Drug Prescription'">
                    <div class="panel panel-primary panel-marginless-sides">
                        <div class="panel-heading">
                            <h3 class="panel-title">{{'NEW_TEST_ORDER'| translate}}</h3>
                        </div>
                        <div class="panel-body">

                            <div class="form-group form-group-lg" ng-class="{'has-error': laborderForm.date.$invalid && vm.showMessages}" ng-show="vm.externalRequest">
                                <label class="col-sm-3 control-label">
                                    {{'COMMON_DATE'| translate}}:
                                    <span class="asterick">*</span>
                                </label>
                                <div class="col-sm-9">
                                    <div class="input-group">
                                        <input class="form-control keyboard-in" id="date" type="text" name="date" uib-datepicker-popup ng-focus="focused=true" is-open="focused"
                                            ng-model="vm.date" required>
                                        <span class="input-group-addon">
                                            <span class="glyphicon glyphicon-calendar"></span>
                                        </span>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group form-group-lg" ng-class="{'has-error': laborderForm.selectedProvider.$invalid && vm.showMessages}"
                                ng-show="vm.externalRequest">
                                <label for="provider" class="col-sm-3 control-label">
                                    {{'COMMON_PROVIDER' | translate}}:
                                    <span class="asterick">*</span>
                                </label>
                                <div class="col-sm-9">
                                    <div ng-messages for="laborderForm.selectedProvider.$error" ng-show="vm.showMessages">
                                        <div ng-messages-include="../poc-common/form-display/views/error-messages.html"></div>
                                    </div>
                                    <input name="selectedProvider" uib-typeahead="p as p.display for p in vm.providers" type="text" ng-model="vm.selectedProvider"
                                        id="provider" class="form-control keyboard-in" required/>
                                </div>
                            </div>

                            <div class="form-group form-group-lg" ng-class="{'has-error': laborderForm.selectedProfile.$invalid && vm.showMessages}">
                                <label for="profile" class="col-sm-3 control-label">
                                    {{'PROFILE' | translate}}:
                                </label>
                                <div class="col-sm-7">
                                    <div ng-messages for="laborderForm.selectedProfile.$error" ng-show="vm.showMessages">
                                        <div ng-messages-include="../poc-common/form-display/views/error-messages.html"></div>
                                    </div>
                                    <input name="selectedProfile" uib-typeahead="p as p.name for p in vm.profiles" type="text" ng-model="vm.selectedProfile"
                                        id="profile" class="form-control keyboard-in" required/>
                                </div>
                                <div class="col-sm-2">
                                    <button class="btn btn-primary btn-lg" type="button" ng-click="vm.addTestProfile()">
                                        <span class="glyphicon glyphicon-plus"></span>
                                        <span class="button-label">{{'ADD' | translate}}</span>
                                    </button>
                                </div>
                            </div>

                            <div class="form-group form-group-lg" ng-class="{'has-error': laborderForm.selectedTest.$invalid && vm.showMessages}">
                                <label for="profile" class="col-sm-3 control-label">
                                    {{'TEST' | translate}}:
                                </label>
                                <div class="col-sm-7">
                                    <div ng-messages for="laborderForm.selectedTest.$error" ng-show="vm.showMessages">
                                        <div ng-messages-include="../poc-common/form-display/views/error-messages.html"></div>
                                    </div>
                                    <input name="selectedTest" uib-typeahead="t as t.display for t in vm.tests" type="text" ng-model="vm.selectedTest" id="test"
                                        class="form-control keyboard-in" required/>
                                </div>
                                <div class="col-sm-2">
                                    <button class="btn btn-primary btn-lg" type="button" ng-click="vm.addTest()">
                                        <span class="glyphicon glyphicon-plus"></span>
                                        <span class="button-label">{{'ADD' | translate}}</span>
                                    </button>
                                </div>
                            </div>

                            <div class="col-sm-12">

                                <table st-table="vm.selectedTests" st-safe-src="" class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th st-sort="test">{{'TEST' | translate}}</th>
                                            <th st-sort="test">{{'CATEGORY' | translate}}</th>
                                            <th st-sort="test">{{'PROFILE' | translate}}</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr st-select-row="patient" st-select-mode="single" ng-repeat="test in vm.selectedTests">
                                            <td>{{test.display}}</td>
                                            <td>{{test.category.display}}</td>
                                            <td>{{test.profileName}}</td>
                                        </tr>
                                    </tbody>
                                    <tfoot>
                                        <tr ng-show="vm.noResultsMessage">
                                            <td colspan="7" class="text-center">
                                                {{vm.noResultsMessage | translate}}
                                            </td>
                                        </tr>
                                        <tr>
                                            <td colspan="7" class="text-center">
                                                <div st-items-by-page="12" st-displayed-pages="7" st-pagination=""></div>
                                            </td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>


                    </div>
                    <div class="panel panel-primary panel-marginless-sides">
                        <div class="panel-footer go-to-right">
                            <button class="btn btn-default btn-lg" type="button" ng-click="vm.reset(laborderForm)">
                                <span class="glyphicon glyphicon-erase"></span>
                                <span class="button-label">{{'CLEAR' | translate}}</span>
                            </button>
                            <button class="btn btn-primary btn-lg" type="button" ng-click="vm.add(laborderForm.$valid, laborderForm)">
                                <span class="glyphicon glyphicon-plus"></span>
                                <span class="button-label">{{'ADD' | translate}}</span>
                            </button>
                        </div>
                    </div>
                </poc-authorize>
            </form>
        </div>
    </div>

    <div class="col-sm-7">

        <poc-authorize privilege="'Read Drug Prescription'">
            <div class="panel panel-primary panel-marginless-sides" ng-init="vm.initPrescriptions()">
                <div class="panel-heading">
                    <h3 class="panel-title">{{'CLINIC_PRESCRIPTION_PRESCRIBED'| translate}}</h3>
                </div>
                <div class="list-group" ng-repeat="existingPrescription in vm.existingPrescriptions">
                    <div class="bg-info content-border-padding-li">
                        {{'CLINIC_PATIENT_PRESCRIBED' | translate}} {{'COMMON_ON' | translate}} {{existingPrescription.prescriptionDate | date}}
                    </div>
                    <div class="list-group-item" ng-repeat="item in existingPrescription.prescriptionItems">
                        <span>
                            <strong>{{item.drugOrder.drug.display}}</strong>
                            <span ng-if="item.regime">
                                <strong ng-if="item.regime">
                                    ({{item.regime.display}}
                                </strong> : {{item.therapeuticLine.display}})-
                            </span>
                            {{item.drugOrder.dose}} {{item.drugOrder.doseUnits.display}}, {{item.drugOrder.frequency.display}}, {{item.drugOrder.route.display}}
                            - {{item.drugOrder.duration}} {{item.drugOrder.durationUnits.display}}, {{item.dosingInstructions}}
                        </span>
                        <span ng-if="item.regime">
                            (
                            <strong>{{'CLINIC_PRESCRIPTION_ARV_PLAN'| translate}}:</strong> {{item.arvPlan.display}})
                        </span>
                        <span ng-if="item.isProphilaxy">
                            <strong>{{'CLINIC_PRESCRIPTION_PROPHYLAXIS_PLAN'| translate}}:</strong> {{item.prophilaxyPlan.display}}
                        </span>
                        <span ng-if="item.regime && item.interruptionReason">
                            <strong>{{'CLINIC_PRESCRIPTION_ARV_PLAN_INTERRUPDED_FOR'| translate}}:</strong> {{item.interruptionReason}}
                        </span>
                        <span ng-if="item.regime && item.changeReason">
                            <strong>{{'CLINIC_PRESCRIPTION_ARV_CHANGE_FOR'| translate}}:</strong> {{item.changeReason}}
                        </span>
                        <span style="color:green;" ng-hide="!vm.checkActiveAndNewItemStatus(item)">
                            <strong>
                                {{item.statusStranslate | translate}}
                            </strong>
                        </span>
                        <span style="color:orange;" ng-hide="vm.checkActiveAndNewItemStatus(item)">
                            <strong>
                                {{item.statusStranslate | translate}}
                            </strong>
                        </span>
                        <span>
                            <poc-authorize privilege="'Delete Drug Prescription'">
                                <button type="button" class="close btn-lg content-border-margin-regular-sides" ng-click="vm.setPrescriptionItemToCancel(item)"
                                    data-toggle="modal" data-target="#cancelPrescriptionModal" ng-hide="!item.cancellable">
                                    <span class="glyphicon glyphicon-trash" ng-hide="item.status != 'NEW' "></span>
                                    <span class="glyphicon glyphicon-floppy-remove" ng-hide="!item.interruptible"></span>
                                    <span class="button-label" ng-hide="item.status != 'NEW' ">{{'CANCEL' | translate}}</span>
                                    <span class="button-label" ng-hide="!item.interruptible">{{'DISCONTINUE' | translate}}</span>
                                </button>
                            </poc-authorize>
                            <poc-authorize privilege="'Write Drug Prescription'">
                                <button type="button" class="close btn-lg content-border-margin-regular-sides" ng-click="vm.refill(item)" ng-hide="!vm.checkItemIsRefillable(existingPrescription)">
                                    <span class="glyphicon glyphicon-repeat"></span>
                                    <span class="button-label">{{'REFILL' | translate}}</span>
                                </button>
                            </poc-authorize>
                        </span>
                    </div>
                </div>
            </div>
        </poc-authorize>


    </div>
</div>