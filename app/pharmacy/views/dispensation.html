<div ng-init="vm.initPrescriptions()">
    <div ng-show="!vm.prescriptiontNoResultsMessage" class="row bg-info-border bg-info content-border-margin-regular content-border-padding-regular border-rouded">
        <div class="col-sm-12 header-text-lg"><!-- last visit type and dates -->
            <img src="../../images/medical-prescription.png" class="img-responsive inline-align" width="24" height="24" alt="prescription">
            <span><b>{{'PHARMACY_PRESCRIBED_BY' | translate}}:</b> {{vm.prescription.provider.person.display}}</span>
            <span>{{'COMMON_ON' | translate}}: {{vm.prescription.prescriptionDate | date:"MMM d, y"}}</span>
        </div>
    </div>

    <div class="row content-border-margin-regular">
        <div class="panel panel-primary">
          <!-- Default panel contents -->
          <div class="panel-heading">{{'PHARMACY_PRESCRIBED' | translate}}</div>

          <!-- Table -->
          <table class="table table-striped">
            <thead>
                <tr>
                    <th>{{'COMMON_ITEM' | translate}}</th>
                    <th>{{'PHARMACY_VALIDITY' | translate}}</th>
                    <th>{{'PHARMACY_TO_PICKUP' | translate}}</th>
                    <th>{{'PHARMACY_PICKEDUP' | translate}}</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                <tr ng-repeat="item in vm.prescriptions" ng-init="item.disable = false">
                    <td>
                        <span class="text-lg">
                            <strong>{{item.drugOrder.drug.display}}</strong>
                            {{item.drugOrder.dose}}
                            {{item.drugOrder.doseUnits.display}}, {{item.drugOrder.frequency.display}},
                            {{item.drugOrder.route.display}} - {{item.drugOrder.duration}}
                            {{item.drugOrder.durationUnits.display}} ({{item.dosingInstructions}})
                        </span>
                    </td>
                    <td>{{item.drugOrder.autoExpireDate | date:"MMM d, y"}}</td>
                    <td>{{item.drugToPickUp}}</td>
                    <td>{{item.drugPickedUp}}</td>
                    <td>
                        <button class="btn btn-primary btn-lg" type="button" ng-click="vm.select(item)" ng-disabled="item.disable">
                            <span class="glyphicon glyphicon-plus"></span>
                        </button>
                    </td>
                </tr>
            </tbody>
            <tfoot>
                <tr ng-show="vm.prescriptiontNoResultsMessage">
                    <td colspan="5" class="text-center">
                        {{vm.prescriptiontNoResultsMessage | translate}}
                    </td>
                </tr>
            </tfoot>
          </table>
        </div>

        <div class="panel panel-primary" ng-form>
          <!-- Default panel contents -->
          <div class="panel-heading">{{'PHARMACY_DISPENSE' | translate}}</div>

          <!-- Table -->
          <table class="table table-striped" ng-form="dispenseForm">
            <thead>
                <tr>
                    <th>{{'COMMON_ITEM' | translate}}</th>
                    <th>{{'PHARMACY_NEXT_PICKUP' | translate}}<span class="asterick">*</span></th>
                    <th>{{'PHARMACY_QUANTITY' | translate}}</th>
                    <th>{{'PHARMACY_AVAILABLE' | translate}}</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                <tr ng-repeat="item in vm.selectedItems track by $index">
                    <td>
                        <span class="text-lg">
                            <strong>{{item.drugOrder.drug.display}}</strong>
                            {{item.drugOrder.dose}}
                            {{item.drugOrder.doseUnits.display}}, {{item.drugOrder.frequency.display}},
                            {{item.drugOrder.route.display}} - {{item.drugOrder.duration}}
                            {{item.drugOrder.durationUnits.display}} ({{item.dosingInstructions}})
                        </span>
                    </td>
                    <td>
                        <div ng-if="item.showNextPickupDate" class="form-group form-group-lg"
                        ng-class="{'has-error': dispenseForm.nextPickupDate.$invalid && showMessages}">
                            <div class="col-sm-8">
                                <div ng-messages for="dispenseForm.nextPickupDate.$error"
                                ng-messages-include="../poc-common/form-display/views/error-messages.html"
                                ng-show="showMessages">
                                </div>
                                <span>{{item.nextPickupDate | date:"MMM d, y"}} </span>
                            </div>
                        </div>
                    </td>
                    <td>
                        <div ng-if="item.showNextPickupDate" class="form-group form-group-lg"
                             ng-class="{'has-error': dispenseForm.quantity.$invalid && showMessages}">
                            <div class="col-sm-8">
                                <div ng-messages for="dispenseForm.quantity.$error"
                                ng-messages-include="../poc-common/form-display/views/error-messages.html"
                                ng-show="showMessages">
                                </div>
                                <input type="number" name="quantity" class="form-control" ng-model="item.quantity" ng-change="vm.updatePickUp(item)" size="4" min="1" required>
                            </div>
                        </div>
                        <span ng-if="!item.drugRegime">{{item.drugOrder.quantity}}</span>
                    </td>
                    <td>
                        <label class="label label-success"><span class="glyphicon glyphicon-thumbs-up"></span></label>
                    </td>
                    <td>
                        <button type="button" class="btn btn-danger btn-lg" ng-click="vm.remove(item)">
                            <span class="glyphicon glyphicon-remove-sign"></span>
                        </button>
                    </td>
                </tr>
            </tbody>
            <tfoot>
                <tr ng-show="vm.dispenseListNoResultsMessage">
                    <td colspan="5" class="text-center">
                        {{vm.dispenseListNoResultsMessage | translate}}
                    </td>
                </tr>
            </tfoot>
          </table>
          <div class="panel-footer go-to-right" ng-show="!vm.dispenseListNoResultsMessage">
                <button class="btn btn-primary btn-lg" type="button" ng-click="vm.dispense()">
                    <span class="glyphicon glyphicon-floppy-disk"></span>
                </button>
          </div>
        </div>
    </div>
</div>
<!-- TODO - barCode Should Be integrated as soon as possible
<barcode-listener
   on-scan='vm.barcodeHandler'
   prefix=''
   length=''
   scan-duration='500'
 ></barcode-listener>
-->

